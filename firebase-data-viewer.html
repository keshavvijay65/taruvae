<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taruvae Firebase Data Viewer</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2D5016 0%, #4A7C2A 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .controls {
            padding: 20px 30px;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #2D5016;
            color: white;
        }

        .btn-primary:hover {
            background: #4A7C2A;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(45, 80, 22, 0.3);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .status {
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            margin-left: auto;
        }

        .status.loading {
            background: #fff3cd;
            color: #856404;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
        }

        .content {
            padding: 30px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #e9ecef;
        }

        .tab {
            padding: 15px 30px;
            background: none;
            border: none;
            font-size: 16px;
            font-weight: 600;
            color: #6c757d;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .tab.active {
            color: #2D5016;
            border-bottom-color: #2D5016;
        }

        .tab:hover {
            color: #2D5016;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
        }

        .stat-card h3 {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-card .value {
            font-size: 2.5em;
            font-weight: bold;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .data-table thead {
            background: #2D5016;
            color: white;
        }

        .data-table th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 12px;
            letter-spacing: 1px;
        }

        .data-table td {
            padding: 15px;
            border-bottom: 1px solid #e9ecef;
        }

        .data-table tbody tr:hover {
            background: #f8f9fa;
        }

        .data-table tbody tr:last-child td {
            border-bottom: none;
        }

        .badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-success {
            background: #d4edda;
            color: #155724;
        }

        .badge-warning {
            background: #fff3cd;
            color: #856404;
        }

        .badge-info {
            background: #d1ecf1;
            color: #0c5460;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6c757d;
        }

        .empty-state svg {
            width: 100px;
            height: 100px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .json-view {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
                align-items: stretch;
            }

            .status {
                margin-left: 0;
                margin-top: 10px;
            }

            .data-table {
                font-size: 12px;
            }

            .data-table th,
            .data-table td {
                padding: 10px 8px;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>üî• Taruvae Firebase Data Viewer</h1>
            <p>View all your orders and customers data</p>
        </div>

        <div class="controls">
            <button class="btn btn-primary" onclick="loadData()">üîÑ Refresh Data</button>
            <button class="btn btn-secondary" onclick="exportData()">üì• Export JSON</button>
            <div class="status" id="status">Ready</div>
        </div>

        <div class="content">
            <div class="tabs">
                <button class="tab active" onclick="switchTab('orders')">üì¶ Orders</button>
                <button class="tab" onclick="switchTab('users')">üë• All Users</button>
                <button class="tab" onclick="switchTab('logged-in')">üîê Logged In Users</button>
                <button class="tab" onclick="switchTab('raw')">üìÑ Raw Data</button>
            </div>

            <!-- Orders Tab -->
            <div id="orders-tab" class="tab-content active">
                <div class="stats" id="orders-stats"></div>
                <div style="overflow-x: auto;">
                    <table class="data-table" id="orders-table">
                        <thead>
                            <tr>
                                <th>Order ID</th>
                                <th>Customer</th>
                                <th>Email</th>
                                <th>Phone</th>
                                <th>Items</th>
                                <th>Total</th>
                                <th>Date</th>
                                <th>Status</th>
                                <th>Details</th>
                            </tr>
                        </thead>
                        <tbody id="orders-body"></tbody>
                    </table>
                </div>
            </div>

            <!-- Users Tab -->
            <div id="users-tab" class="tab-content">
                <div class="stats" id="users-stats"></div>
                <div style="overflow-x: auto;">
                    <table class="data-table" id="users-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Phone</th>
                                <th>Provider</th>
                                <th>Created</th>
                                <th>Last Login</th>
                            </tr>
                        </thead>
                        <tbody id="users-body"></tbody>
                    </table>
                </div>
            </div>

            <!-- Logged In Users Tab -->
            <div id="logged-in-tab" class="tab-content">
                <div class="stats" id="logged-in-stats"></div>
                <div style="overflow-x: auto;">
                    <table class="data-table" id="logged-in-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Phone</th>
                                <th>Provider</th>
                                <th>Created</th>
                                <th>Last Login</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="logged-in-body"></tbody>
                    </table>
                </div>
            </div>

            <!-- Raw Data Tab -->
            <div id="raw-tab" class="tab-content">
                <div class="json-view" id="raw-data"></div>
            </div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDWpkuJPQFxbgH3kH7IBjPQk5eBH0oF95g",
            authDomain: "taruveda-naturals-fd588.firebaseapp.com",
            databaseURL: "https://taruveda-naturals-fd588-default-rtdb.firebaseio.com",
            projectId: "taruveda-naturals-fd588",
            storageBucket: "taruveda-naturals-fd588.firebasestorage.app",
            messagingSenderId: "585062522821",
            appId: "1:585062522821:web:94387059217dcdf9a4b5ac"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        let allData = {
            orders: [],
            users: []
        };

        function updateStatus(message, type = 'success') {
            const statusEl = document.getElementById('status');
            statusEl.textContent = message;
            statusEl.className = `status ${type}`;
        }

        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(`${tabName}-tab`).classList.add('active');
            event.target.classList.add('active');
        }

        async function loadData() {
            updateStatus('Loading data...', 'loading');

            try {
                // Load Orders
                const ordersRef = database.ref('orders');
                const ordersSnapshot = await ordersRef.once('value');
                const ordersData = ordersSnapshot.val();
                allData.orders = ordersData ? Object.values(ordersData) : [];

                // Load Users from Firebase users path
                const usersRef = database.ref('users');
                const usersSnapshot = await usersRef.once('value');
                const usersData = usersSnapshot.val();

                console.log('Raw users data from Firebase:', usersData);

                let firebaseUsers = [];
                if (usersData) {
                    // Handle both object and array formats
                    if (Array.isArray(usersData)) {
                        firebaseUsers = usersData;
                    } else {
                        firebaseUsers = Object.values(usersData);
                    }
                }

                console.log('Users from Firebase users path:', firebaseUsers.length);

                // Also extract customers from orders (like admin panel does)
                const customersFromOrders = [];
                const customerMap = new Map();

                allData.orders.forEach(order => {
                    if (order.customer && order.customer.email) {
                        const email = order.customer.email.toLowerCase().trim();
                        if (!email) return;

                        if (!customerMap.has(email)) {
                            customerMap.set(email, {
                                id: order.userId || order.customer.email,
                                email: order.customer.email,
                                name: `${order.customer.firstName || ''} ${order.customer.lastName || ''}`.trim() || 'Guest Customer',
                                phone: order.customer.phone || 'N/A',
                                provider: 'email',
                                createdAt: order.orderDate || new Date().toISOString(),
                                lastLogin: null,
                                fromOrders: true
                            });
                        }
                    }
                });

                const customersFromOrdersArray = Array.from(customerMap.values());
                console.log('Customers extracted from orders:', customersFromOrdersArray.length);

                // Merge Firebase users and customers from orders
                // Use a map to avoid duplicates by email
                const mergedUsersMap = new Map();

                // Add Firebase users first (these have login info)
                firebaseUsers.forEach(user => {
                    if (user && user.email) {
                        const email = user.email.toLowerCase().trim();
                        if (email) {
                            mergedUsersMap.set(email, {
                                ...user,
                                fromFirebase: true
                            });
                        }
                    }
                });

                // Add customers from orders (merge with Firebase users if email matches)
                customersFromOrdersArray.forEach(customer => {
                    const email = customer.email.toLowerCase().trim();
                    if (email) {
                        if (!mergedUsersMap.has(email)) {
                            // New customer from orders - add as is
                            mergedUsersMap.set(email, {
                                ...customer,
                                fromOrders: true
                            });
                        } else {
                            // Email exists in Firebase users - merge data intelligently
                            const existing = mergedUsersMap.get(email);
                            mergedUsersMap.set(email, {
                                // Keep all Firebase user data (has login info)
                                ...existing,
                                // Update with order customer data (name, phone might be more recent)
                                name: customer.name || existing.name,
                                phone: customer.phone || existing.phone,
                                // Keep Firebase login info
                                lastLogin: existing.lastLogin || customer.lastLogin,
                                createdAt: existing.createdAt || customer.createdAt,
                                provider: existing.provider || customer.provider,
                                // Mark that this user has both Firebase and order data
                                fromFirebase: true,
                                fromOrders: true
                            });
                        }
                    }
                });

                allData.users = Array.from(mergedUsersMap.values());

                console.log('Merged users breakdown:');
                console.log('- From Firebase only:', allData.users.filter(u => u.fromFirebase && !u.fromOrders).length);
                console.log('- From Orders only:', allData.users.filter(u => u.fromOrders && !u.fromFirebase).length);
                console.log('- From Both:', allData.users.filter(u => u.fromFirebase && u.fromOrders).length);

                console.log('Total merged users:', allData.users.length);
                console.log('Users array:', allData.users);

                displayOrders();
                displayUsers();
                displayLoggedInUsers();
                displayRawData();

                updateStatus(`Loaded ${allData.orders.length} orders & ${allData.users.length} users`, 'success');
            } catch (error) {
                console.error('Error loading data:', error);
                updateStatus('Error loading data: ' + error.message, 'error');
            }
        }

        function displayOrders() {
            const tbody = document.getElementById('orders-body');
            const statsDiv = document.getElementById('orders-stats');

            if (allData.orders.length === 0) {
                tbody.innerHTML = '<tr><td colspan="9" class="empty-state">No orders found</td></tr>';
                statsDiv.innerHTML = '';
                return;
            }

            // Calculate stats
            const totalRevenue = allData.orders.reduce((sum, order) => sum + (order.total || 0), 0);
            const totalItems = allData.orders.reduce((sum, order) => sum + (order.items?.length || 0), 0);
            const confirmedOrders = allData.orders.filter(o => o.status === 'confirmed' || !o.status).length;

            statsDiv.innerHTML = `
                <div class="stat-card">
                    <h3>Total Orders</h3>
                    <div class="value">${allData.orders.length}</div>
                </div>
                <div class="stat-card">
                    <h3>Total Revenue</h3>
                    <div class="value">‚Çπ${totalRevenue.toLocaleString()}</div>
                </div>
                <div class="stat-card">
                    <h3>Total Items</h3>
                    <div class="value">${totalItems}</div>
                </div>
                <div class="stat-card">
                    <h3>Confirmed</h3>
                    <div class="value">${confirmedOrders}</div>
                </div>
            `;

            tbody.innerHTML = allData.orders.map((order, index) => {
                const customer = order.customer || {};
                const orderDate = order.orderDate ? new Date(order.orderDate).toLocaleDateString('en-IN') : 'N/A';
                const status = order.status || 'confirmed';
                const items = order.items || [];
                const itemsList = items.map(item =>
                    `${item.name || 'N/A'} (Qty: ${item.quantity || 0}, ‚Çπ${(item.price || 0).toLocaleString()})`
                ).join('<br>');

                return `
                    <tr>
                        <td><strong>${order.orderId || 'N/A'}</strong></td>
                        <td>${customer.firstName || ''} ${customer.lastName || ''}</td>
                        <td>${customer.email || 'N/A'}</td>
                        <td>${customer.phone || 'N/A'}</td>
                        <td>${items.length} items</td>
                        <td><strong>‚Çπ${(order.total || 0).toLocaleString()}</strong></td>
                        <td>${orderDate}</td>
                        <td><span class="badge badge-${status === 'delivered' ? 'success' : status === 'cancelled' ? 'warning' : 'info'}">${status}</span></td>
                        <td>
                            <button class="btn btn-secondary" style="padding: 6px 12px; font-size: 12px;" onclick="showOrderDetails(${index})">
                                üëÅÔ∏è View
                            </button>
                        </td>
                    </tr>
                    <tr id="order-details-${index}" style="display: none;">
                        <td colspan="9" style="background: #f8f9fa; padding: 20px;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                                <div>
                                    <h4 style="margin-bottom: 10px; color: #2D5016;">üì¶ Order Items</h4>
                                    <div style="background: white; padding: 15px; border-radius: 8px; border: 1px solid #e9ecef;">
                                        ${items.length > 0 ? items.map(item => `
                                            <div style="padding: 10px; border-bottom: 1px solid #e9ecef; display: flex; justify-content: space-between;">
                                                <div>
                                                    <strong>${item.name || 'N/A'}</strong><br>
                                                    <small style="color: #6c757d;">Quantity: ${item.quantity || 0} √ó ‚Çπ${(item.price || 0).toLocaleString()}</small>
                                                </div>
                                                <div style="font-weight: bold; color: #2D5016;">
                                                    ‚Çπ${((item.price || 0) * (item.quantity || 0)).toLocaleString()}
                                                </div>
                                            </div>
                                        `).join('') : '<p>No items found</p>'}
                                    </div>
                                </div>
                                <div>
                                    <h4 style="margin-bottom: 10px; color: #2D5016;">üìã Order Summary</h4>
                                    <div style="background: white; padding: 15px; border-radius: 8px; border: 1px solid #e9ecef;">
                                        <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #e9ecef;">
                                            <span>Subtotal:</span>
                                            <strong>‚Çπ${(order.subtotal || 0).toLocaleString()}</strong>
                                        </div>
                                        <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #e9ecef;">
                                            <span>Shipping:</span>
                                            <strong>${order.shipping === 0 ? 'Free' : '‚Çπ' + (order.shipping || 0).toLocaleString()}</strong>
                                        </div>
                                        <div style="display: flex; justify-content: space-between; padding: 8px 0; font-size: 1.2em; font-weight: bold; color: #2D5016;">
                                            <span>Total:</span>
                                            <span>‚Çπ${(order.total || 0).toLocaleString()}</span>
                                        </div>
                                        <div style="margin-top: 15px; padding-top: 15px; border-top: 2px solid #e9ecef;">
                                            <p><strong>Payment:</strong> ${order.paymentMethod === 'cod' ? 'Cash on Delivery' : 'Online Payment'}</p>
                                            ${order.trackingNumber ? `<p><strong>Tracking:</strong> ${order.trackingNumber}</p>` : ''}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div style="background: white; padding: 15px; border-radius: 8px; border: 1px solid #e9ecef;">
                                <h4 style="margin-bottom: 10px; color: #2D5016;">üìç Shipping Address</h4>
                                <p>${order.shippingAddress?.address || 'N/A'}</p>
                                <p>${order.shippingAddress?.city || ''}, ${order.shippingAddress?.state || ''} - ${order.shippingAddress?.pincode || ''}</p>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function displayUsers() {
            const tbody = document.getElementById('users-body');
            const statsDiv = document.getElementById('users-stats');

            console.log('Displaying users, count:', allData.users.length);
            console.log('Users data:', allData.users);

            if (!allData.users || allData.users.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" class="empty-state">No users found in Firebase. Users will appear here once they register/login.</td></tr>';
                statsDiv.innerHTML = `
                    <div class="stat-card">
                        <h3>Total Users</h3>
                        <div class="value">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Email Users</h3>
                        <div class="value">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Google Users</h3>
                        <div class="value">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Logged In</h3>
                        <div class="value">0</div>
                    </div>
                `;
                return;
            }

            // Calculate stats
            const emailUsers = allData.users.filter(u => u.provider === 'email').length;
            const googleUsers = allData.users.filter(u => u.provider === 'google').length;
            const withPhone = allData.users.filter(u => u.phone).length;
            const loggedInUsers = allData.users.filter(u => u.lastLogin).length;

            statsDiv.innerHTML = `
                <div class="stat-card">
                    <h3>Total Users</h3>
                    <div class="value">${allData.users.length}</div>
                </div>
                <div class="stat-card">
                    <h3>Email Users</h3>
                    <div class="value">${emailUsers}</div>
                </div>
                <div class="stat-card">
                    <h3>Google Users</h3>
                    <div class="value">${googleUsers}</div>
                </div>
                <div class="stat-card">
                    <h3>Logged In</h3>
                    <div class="value">${loggedInUsers}</div>
                </div>
            `;

            tbody.innerHTML = allData.users.map(user => {
                const createdDate = user.createdAt ? new Date(user.createdAt).toLocaleDateString('en-IN') : 'N/A';
                const lastLogin = user.lastLogin ? new Date(user.lastLogin).toLocaleDateString('en-IN') : 'Never';
                const hasLoggedIn = user.lastLogin ? 'badge-success' : 'badge-warning';

                return `
                    <tr style="${user.lastLogin ? 'background: #f0f9ff;' : ''}">
                        <td><code>${user.id || 'N/A'}</code></td>
                        <td><strong>${user.name || 'N/A'}</strong></td>
                        <td>${user.email || 'N/A'}</td>
                        <td>${user.phone || 'N/A'}</td>
                        <td><span class="badge badge-info">${user.provider || 'email'}</span></td>
                        <td>${createdDate}</td>
                        <td><span class="badge ${hasLoggedIn}">${lastLogin}</span></td>
                    </tr>
                `;
            }).join('');
        }

        function displayLoggedInUsers() {
            const tbody = document.getElementById('logged-in-body');
            const statsDiv = document.getElementById('logged-in-stats');

            if (!allData.users || allData.users.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" class="empty-state">No users found. Users will appear here once they register/login.</td></tr>';
                statsDiv.innerHTML = '';
                return;
            }

            // Filter only users who have logged in (have lastLogin)
            const loggedInUsers = allData.users.filter(u => u && u.lastLogin);

            console.log('Logged in users:', loggedInUsers.length);
            console.log('All users with lastLogin check:', allData.users.map(u => ({ id: u?.id, lastLogin: u?.lastLogin })));

            if (loggedInUsers.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" class="empty-state">No logged-in users found. Users need to login at least once to appear here.</td></tr>';
                statsDiv.innerHTML = `
                    <div class="stat-card">
                        <h3>Logged In Users</h3>
                        <div class="value">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Email Users</h3>
                        <div class="value">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Google Users</h3>
                        <div class="value">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Recent (7 days)</h3>
                        <div class="value">0</div>
                    </div>
                `;
                return;
            }

            // Sort by last login (most recent first)
            loggedInUsers.sort((a, b) => {
                const dateA = a.lastLogin ? new Date(a.lastLogin).getTime() : 0;
                const dateB = b.lastLogin ? new Date(b.lastLogin).getTime() : 0;
                return dateB - dateA;
            });

            // Calculate stats
            const emailUsers = loggedInUsers.filter(u => u.provider === 'email').length;
            const googleUsers = loggedInUsers.filter(u => u.provider === 'google').length;
            const withPhone = loggedInUsers.filter(u => u.phone).length;
            const recentLogins = loggedInUsers.filter(u => {
                if (!u.lastLogin) return false;
                const loginDate = new Date(u.lastLogin);
                const daysAgo = (Date.now() - loginDate.getTime()) / (1000 * 60 * 60 * 24);
                return daysAgo <= 7; // Last 7 days
            }).length;

            statsDiv.innerHTML = `
                <div class="stat-card">
                    <h3>Logged In Users</h3>
                    <div class="value">${loggedInUsers.length}</div>
                </div>
                <div class="stat-card">
                    <h3>Email Users</h3>
                    <div class="value">${emailUsers}</div>
                </div>
                <div class="stat-card">
                    <h3>Google Users</h3>
                    <div class="value">${googleUsers}</div>
                </div>
                <div class="stat-card">
                    <h3>Recent (7 days)</h3>
                    <div class="value">${recentLogins}</div>
                </div>
            `;

            tbody.innerHTML = loggedInUsers.map(user => {
                const createdDate = user.createdAt ? new Date(user.createdAt).toLocaleDateString('en-IN') : 'N/A';
                const lastLogin = user.lastLogin ? new Date(user.lastLogin).toLocaleDateString('en-IN', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                }) : 'Never';

                // Calculate days since last login
                const daysSinceLogin = user.lastLogin ? Math.floor((Date.now() - new Date(user.lastLogin).getTime()) / (1000 * 60 * 60 * 24)) : null;
                let statusBadge = '';
                if (daysSinceLogin !== null) {
                    if (daysSinceLogin === 0) {
                        statusBadge = '<span class="badge badge-success">Active Today</span>';
                    } else if (daysSinceLogin <= 7) {
                        statusBadge = `<span class="badge badge-success">${daysSinceLogin} days ago</span>`;
                    } else if (daysSinceLogin <= 30) {
                        statusBadge = `<span class="badge badge-info">${daysSinceLogin} days ago</span>`;
                    } else {
                        statusBadge = `<span class="badge badge-warning">${daysSinceLogin} days ago</span>`;
                    }
                }

                return `
                    <tr style="background: #f0f9ff;">
                        <td><code>${user.id || 'N/A'}</code></td>
                        <td><strong>${user.name || 'N/A'}</strong></td>
                        <td>${user.email || 'N/A'}</td>
                        <td>${user.phone || 'N/A'}</td>
                        <td><span class="badge badge-info">${user.provider || 'email'}</span></td>
                        <td>${createdDate}</td>
                        <td><strong>${lastLogin}</strong></td>
                        <td>${statusBadge}</td>
                    </tr>
                `;
            }).join('');
        }

        function displayRawData() {
            const rawDiv = document.getElementById('raw-data');
            rawDiv.textContent = JSON.stringify(allData, null, 2);
        }

        function showOrderDetails(index) {
            const detailsRow = document.getElementById(`order-details-${index}`);
            if (detailsRow.style.display === 'none') {
                detailsRow.style.display = 'table-row';
            } else {
                detailsRow.style.display = 'none';
            }
        }

        function exportData() {
            const dataStr = JSON.stringify(allData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `taruvae-data-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
            updateStatus('Data exported successfully!', 'success');
        }

        // Auto-load on page load
        window.addEventListener('load', () => {
            loadData();
        });
    </script>
</body>

</html>